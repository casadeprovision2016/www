# üìñ Configuraci√≥n del Microblog con Blogger API

Esta documentaci√≥n explica c√≥mo configurar y utilizar la integraci√≥n del microblog con la API de Blogger para las ense√±anzas de los martes.

## üéØ Resumen de la Implementaci√≥n

La funcionalidad de microblog permite mostrar autom√°ticamente los posts del blog de Blogger en el sitio web de la iglesia, espec√≠ficamente las "Ense√±anzas de los Martes". Los posts se obtienen a trav√©s de la API de Blogger v3 y se muestran con el dise√±o del sitio.

## üîß Configuraci√≥n Inicial

### 1. Configuraci√≥n de Google Cloud Console

1. **Crear proyecto en Google Cloud Console**:
   - Ir a [Google Cloud Console](https://console.cloud.google.com/)
   - Crear un nuevo proyecto o seleccionar uno existente
   - Nombre sugerido: "CCCP-Blogger-Integration"

2. **Activar la API de Blogger**:
   - En el panel de APIs y servicios
   - Buscar "Blogger API v3"
   - Hacer clic en "Habilitar"

3. **Crear credenciales**:
   - Ir a "Credenciales" > "Crear credenciales" > "Clave de API"
   - Copiar la clave generada
   - **Importante**: Restricciones de seguridad recomendadas:
     - Restricci√≥n de aplicaci√≥n: "Restricciones de IP" (agregar IPs del servidor)
     - Restricci√≥n de API: Seleccionar solo "Blogger API v3"

### 2. Configuraci√≥n del Blog de Blogger

1. **Crear blog en Blogger**:
   - Ir a [blogger.com](https://www.blogger.com)
   - Crear un nuevo blog o usar uno existente
   - Nombre sugerido: "Ense√±anzas CCCP"

2. **Obtener el ID del blog**:
   - En la URL del blog: `https://ejemplo.blogspot.com/`
   - O desde la configuraci√≥n del blog en Blogger
   - El ID es una cadena como: `1234567890123456789`

3. **Configurar etiquetas/labels**:
   - Usar etiquetas consistentes para categorizar posts:
     - `ense√±anza-martes` - Para las ense√±anzas de los martes
     - `reflexion` - Para reflexiones pastorales
     - `devocional` - Para devocionales
     - `anuncio` - Para anuncios
     - `testimonio` - Para testimonios

## üî® Configuraci√≥n del Sistema

### 1. Variables de Entorno

**Backend** (`/api/.env`):
```env
# Blogger API Configuration
BLOGGER_API_KEY=AIzaSyAGzTT-4vd5AwSm_T34rWF_Q1vqiAiaOHY
```

**Frontend** (`/frontend/.env`):
```env
# Blogger API Configuration
VITE_BLOGGER_ID=YOUR_BLOG_ID_HERE
```

### 2. Instalaci√≥n de Dependencias

**Backend**:
```bash
cd api
npm install axios
```

**Frontend**: Ya incluido en las dependencias existentes.

## üöÄ Uso del Sistema

### 1. Para el Pastor/Administrador

**Creaci√≥n de posts en Blogger**:
1. Ir al panel de Blogger
2. Crear nueva entrada
3. **Importante**: Agregar las etiquetas apropiadas:
   - Para ense√±anzas de martes: `ense√±anza-martes`
   - Para otras categor√≠as: usar las etiquetas definidas
4. Publicar el post

**Gesti√≥n desde el panel CCCP**:
- Los l√≠deres y administradores pueden acceder a "Ense√±anzas" en el panel
- Ver estad√≠sticas de posts
- Limpiar cach√© si es necesario
- Filtrar por categor√≠as

### 2. Para los Miembros

**Visualizaci√≥n en el sitio web**:
- Secci√≥n "Ense√±anzas de los Martes" en la p√°gina principal
- P√°gina dedicada en `/ense√±anzas-martes`
- Posts mostrados con dise√±o del sitio
- Enlace directo al post original en Blogger

## üìã Estructura de la Implementaci√≥n

### 1. Backend (API)

**Archivos principales**:
- `api/src/services/bloggerService.ts` - Servicio principal para Blogger API
- `api/src/controllers/microblogController.ts` - Controladores de endpoints
- `api/src/routes/microblog.ts` - Rutas de la API

**Endpoints disponibles**:
```
GET /api/microblog/ense√±anzas-martes?blogId={ID}&maxResults={N}
GET /api/microblog/posts?blogId={ID}&category={CAT}
GET /api/microblog/posts/{blogId}/{postId}
GET /api/microblog/blog/{blogId}
GET /api/microblog/category/{category}?blogId={ID}
POST /api/microblog/cache/clear
GET /api/microblog/stats
```

### 2. Frontend (React)

**Componentes principales**:
- `Ense√±anzasMartesSection.tsx` - Secci√≥n para p√°gina principal
- `Ense√±anzasMartes.tsx` - Componente completo de visualizaci√≥n
- `Ense√±anzasMartesPage.tsx` - P√°gina dedicada
- `MicroblogManager.tsx` - Panel de administraci√≥n

**Hook personalizado**:
- `useMicroblog.ts` - Hook para manejar llamadas a la API

## ‚ö° Caracter√≠sticas Implementadas

### 1. Funcionalidades Principales

- ‚úÖ **Integraci√≥n autom√°tica** con Blogger API v3
- ‚úÖ **Cache inteligente** con Redis (1 hora de TTL)
- ‚úÖ **Filtrado por categor√≠as** usando labels
- ‚úÖ **Visualizaci√≥n segura** del contenido HTML
- ‚úÖ **Responsive design** con Tailwind CSS
- ‚úÖ **Panel de administraci√≥n** para l√≠deres
- ‚úÖ **Paginaci√≥n** de posts
- ‚úÖ **B√∫squeda** por t√≠tulo y contenido

### 2. Seguridad

- ‚úÖ **Sanitizaci√≥n de HTML** para prevenir XSS
- ‚úÖ **Autenticaci√≥n requerida** para acceso a posts
- ‚úÖ **Control de permisos** por roles
- ‚úÖ **Rate limiting** en la API
- ‚úÖ **Validaci√≥n de par√°metros** con Zod

### 3. Performance

- ‚úÖ **Cache con Redis** para reducir llamadas a Blogger API
- ‚úÖ **Lazy loading** de componentes
- ‚úÖ **Optimizaci√≥n de im√°genes** autom√°tica
- ‚úÖ **Compresi√≥n de contenido** HTML

## üîÑ Mantenimiento

### 1. Monitoreo

**Logs a revisar**:
- Errores de conexi√≥n con Blogger API
- Cache hits/misses
- Tiempo de respuesta de endpoints
- Errores de autenticaci√≥n

**Comandos √∫tiles**:
```bash
# Ver logs del backend
docker logs cccp-api

# Limpiar cache manualmente
curl -X POST "http://localhost:4444/api/microblog/cache/clear" \
     -H "Authorization: Bearer TOKEN"
```

### 2. Soluci√≥n de Problemas

**Error 403 - API Key inv√°lida**:
1. Verificar que la API key est√© correcta en `.env`
2. Confirmar que Blogger API v3 est√© habilitada
3. Revisar restricciones de IP en Google Cloud Console

**Error 404 - Blog no encontrado**:
1. Verificar que el `VITE_BLOGGER_ID` sea correcto
2. Confirmar que el blog sea p√∫blico o est√© configurado correctamente

**Posts no aparecen**:
1. Verificar que los posts tengan las etiquetas correctas
2. Confirmar que los posts est√©n publicados (no en borrador)
3. Limpiar cache del microblog

### 3. Backup y Recuperaci√≥n

**Backup autom√°tico**:
- Los posts est√°n almacenados en Blogger (Google)
- Cache en Redis se regenera autom√°ticamente
- No requiere backup adicional

**Recuperaci√≥n**:
- Simplemente limpiar cache para forzar recarga desde Blogger
- Verificar conectividad con la API de Google

## üìä M√©tricas y Analytics

### 1. Estad√≠sticas Disponibles

- N√∫mero total de posts por categor√≠a
- Posts m√°s recientes
- Estad√≠sticas de visualizaci√≥n (futuro)
- Performance de cache

### 2. Reportes

Los l√≠deres pueden ver en el panel:
- Total de posts por categor√≠a
- √öltimos posts publicados
- Estado del cache
- Informaci√≥n del blog

## üîÆ Funcionalidades Futuras

### 1. Mejoras Planificadas

- ‚úÖ **Notificaciones autom√°ticas** cuando se publique nuevo post
- ‚úÖ **RSS feed** generado autom√°ticamente
- ‚úÖ **Compartir en redes sociales** integrado
- ‚úÖ **Comentarios** sincronizados con Blogger
- ‚úÖ **B√∫squeda avanzada** por fecha, autor, etc.

### 2. Integraciones Adicionales

- **WhatsApp Bot** para notificar nuevos posts
- **Email marketing** autom√°tico
- **Analytics** detallado de lecturas
- **PWA** para notificaciones push

## üõ°Ô∏è Consideraciones de Seguridad

### 1. API Keys

- **Nunca** commitear API keys en el repositorio
- Usar variables de entorno en todos los ambientes
- Rotar keys peri√≥dicamente
- Configurar restricciones apropiadas en Google Cloud Console

### 2. Contenido

- Todo contenido HTML es sanitizado antes de mostrarse
- Scripts y contenido peligroso son removidos autom√°ticamente
- Enlaces externos se abren en nueva ventana

### 3. Acceso

- Solo usuarios autenticados pueden ver posts
- L√≠deres y administradores tienen acceso al panel de gesti√≥n
- Logs de acceso para auditor√≠a

---

## üìû Soporte

Para problemas t√©cnicos o configuraci√≥n:

1. **Revisar logs** del sistema
2. **Verificar conectividad** con APIs de Google
3. **Contactar administrador** del sistema
4. **Consultar documentaci√≥n** de Blogger API v3

**Enlaces √∫tiles**:
- [Blogger API v3 Documentation](https://developers.google.com/blogger/docs/3.0/getting_started)
- [Google Cloud Console](https://console.cloud.google.com/)
- [Blogger.com](https://www.blogger.com/)

---

**Fecha de actualizaci√≥n**: Enero 2025  
**Versi√≥n del sistema**: CCCP v1.0  
**Implementado por**: Claude Code Assistant